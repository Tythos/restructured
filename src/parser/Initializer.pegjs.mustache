{
  // utilities
  var _ = require('lodash');
  var ParserUtil = require('./ParserUtil').default;

  function mapByIndex(seq, index) {
    return _.map(seq, function (v) { return v[index]; });
  };

  // nodes
  var Elements = require('./Elements');
  var Text = Elements.Text;

  // variables
  var currentIndentSize = 0;
  var indentSizeStack = [];
  var indentIgnoreLine = null;
  var nextIndentSize = null;
  var prevIndentSize = null;

  var markupEndString = null;
  var attributesIndentList = [];

  var nextEnumeratorType = null;
  var enumeratorStack = [];
  var currentEnumerator = null;

  var enumeratedListState = (function () {
    return {
      startNewEnumeratedList: function () {
        enumeratorStack.push(currentEnumerator);
        currentEnumerator = null;
        nextEnumeratorType = null;
      },
      pushEnumerator: function (enumerator) {
        enumeratorStack.push(current);
        currentEnumerator = enumerator;
      },
      popEnumerator: function () {
        currentEnumerator = enumeratorStack.pop();
      },
    };
  }());

  var indentState = (function () {
    return {
      push: function (indentSize) {
        indentSizeStack.push(currentIndentSize);
        currentIndentSize = indentSize;
      },
      pop: function () {
        currentIndentSize = indentSizeStack.pop();
      },
      ignore: function (line) {
        indentIgnoreLine = line;
      },
    };
  }());

  var bulletListState = (function () {
    var stack = [];
    var current = null;
    return {
      pushBullet: function (bullet) {
        stack.push(current);
        current = bullet;
      },
      popBullet: function () {
        current = stack.pop();
      },
      isSameBullet: function (bullet) {
        return current === bullet;
      },
    };
  }());
}
